<div ng-app="HibiApp" ng-controller="TasksCtrl">
  <h1>#{title}

  $if has FeatureSettings
    <section #settings>
      <h2.collapsed>
        Settings
        ^{expandy Collapsed "#settings h2" "#settings .content"}
      <.content style="display: none">
        $forall featureSetting <- toggleableFeatures
          ^{oneButton "btn" (featureButtonLabel featureSetting) (ToggleFeatureR (fst featureSetting))}

  $if has FeaturePlans
    <section #plans>
      <h2>
        Plans
        ^{expandy Expanded "#plans h2" "#plans .content"}
      <div .content ng-controller="PlansCtrl">
        <form .form-inline ng-submit="addNewPlan()">
          <input required placeholder="Add a plan" ng-model="newPlan.body">
          <input .btn .btn-primary type=submit value=Add>
        <table ng-show="plans.length &gt; 0"><tbody>
          <tr .plan id="plan-{{plan.id}}" ng-class="{broken: plan.broken, going: plan.going}" ng-repeat="plan in plans">
            <td .body>
              <ss-click-to-edit ss-model="plan.plan.body" ss-on-edit="updatePlan(plan)">
                {{plan.plan.body}}
            <td>
              <button .btn .btn-success ng-click="completePlan(plan)">✓
            <td>
              <button .btn .btn-danger ng-click="deletePlan(plan)">☠

  <section #todo>
    <h2>
      TODO
      ^{expandy Expanded "#todo h2" "#todo .content"}

    <div .content>
      <p ng-show="tasks.todoToday().length == 0">
        Nothing to do. Congratulations! Why not take the rest of the day off?
      <table ng-hide="tasks.todoToday().length == 0"><tbody ui-sortable="sortableOptions" ng-model="tasks">
        <tr.task ng-include="'@{TemplateTaskTrR}'" ng-repeat="task in tasks" ng-show="task.isTodoToday()" ng-class="{overdue: #{jsBool (has FeatureOverdueTasks)} && task.isOverdue(), broken: task.broken, going: task.going}" ng-mouseenter="showNotes(task)" ng-mouseleave="hideNotes(task)">
      $if has FeaturePomos
        <h3>
          Remaining: {{estimatedRemaining()}} of {{estimatedTotal()}} estimated
      <form .form-inline ng-submit="addNewTask()">
        <.control-group>
          <.controls>
            <input required name="title" placeholder="Add a task" ng-model="newTask.task.title">
        <.control-group>
          <.controls>
            $forall schedule <- scheduleOptions
              <input type="radio" ng-model="newTask.task.schedule" value="#{schedule}" .inline>
              #{schedule}
        <input .btn .btn-primary type=submit value=Add>

  <section #postponed ng-show="tasks.postponed().length &gt; 0">
    <h2.collapsed>
      Tomorrow
      ^{expandy Collapsed "#postponed h2" "#postponed .content"}

    <.content style="display: none">
      <table><tbody>
        <tr.task ng-include="'@{TemplateTaskTrR}'" ng-repeat="task in tasks | filterP:'isPostponed' | orderBy:postponedOrder" ng-class="{broken: task.broken, going: task.going}" ng-mouseenter="showNotes(task)" ng-mouseleave="hideNotes(task)">

  <section #paused ng-show="tasks.paused().length &gt; 0">
    <h2.collapsed>
      Paused ({{tasks.paused().length}})
      ^{expandy Collapsed "#paused h2" "#paused .content"}

    <.content style="display: none">
      <table><tbody>
        <tr.task ng-include="'@{TemplateTaskTrR}'" ng-repeat="task in tasks | filterP:'isPaused' | orderBy:pausedOrder" ng-class="{broken: task.broken, going: task.going}" ng-mouseenter="showNotes(task)" ng-mouseleave="hideNotes(task)">

  <section #done ng-controller="DoneTasksCtrl" ng-show="tasks.done().length &gt; 0">
    <h2.collapsed>
      Done
      ^{expandy Collapsed "#done h2" "#done .content"}

    <.content style="display: none">
      <div ng-repeat="taskPerDay in tasksToFilter() | filterP:'isDone' | filter:uniqueDay | orderBy:dayOrder:true">
        <h3>{{dayDone(taskPerDay)}}
        <table><tbody>
          <tr.task ng-include="'@{TemplateTaskTrR}'" ng-repeat="task in tasks | filterP:'isDone' | filter:doneSameDay(taskPerDay) | orderBy:doneOrder:true" ng-class="{broken: task.broken, going: task.going}" ng-mouseenter="showNotes(task)" ng-mouseleave="hideNotes(task)">
